flowchart TD
%% ===============================
%% K-means Clustering on Iris Data
%% ===============================

%% Inputs
%%  A[Select X variable]:::input
%%  B[Select Y variable]:::input
%%  C[Select number of clusters]:::input
    dropdownResearcher[dropdown for researcher]:::input
    dropdownCompany[dropdown for company]:::input
    dropdownMainResearchGroup[dropdown for main research group]:::input

%% Source
%%  D[(iris dataset)]:::source
    rneDatabase[(rne database)]:::source

%% Reactives
%%  E>subset: iris, input$xvar, input$yvar]:::reactive
%%  F>kmeans, centers = input$clusters]:::reactive
    projectsFilteredByEndDate>projects filtered by end date]:::reactive

    BQ2A1_projectsFilteredByEndDateAndCountSharedProjects>projects filtered by end_date and counted shared projects per researcher]:::reactive
    BQ2A2_projectsFilteredByEndDateAndCountSharedProjectsAndRankIt>projects filtered by end_date and counted shared projects per researcher, ranked]:::reactive

    BQ3A1_projectsFilteredByEndDateJoinWithResearchersAndCompanies>projects filtered by end date, joined with researchers and companies]:::reactive
    BQ3A2_projectsFilteredByEndDateCountProjectsPerCompanyAndRankIt>projects filtered by end date and count projects per comapny, ranked]:::reactive

    BQ4A1_projectsPerCompany>NR: projects per company, desc]:::reactive

    BQ5A1_projectsFilteredByEndDateAndGroupResearchersByDepartmentAndCountDepartmentPerCompanyAndRankIt>projects filtered by end date, group researchers by department count department per company and rank it]:::reactive
%%    BQ5A2_projectsFilteredByEndDate>projects filtered by end date]:::reactive

    BQ6A1_fteScorePerProject>NR: FTE score per project]:::reactive
    BQ6A2_groupByRole>NR: group by role]:::reactive


%% Output
%%  G[[renderPlot: scatter plot with cluster colors]]:::output
    stackedBarchart[[stacked barchart]]:::output
    barchart[[barchart]]:::output
    table[[table]]:::output
    networkGraph[[network graph]]:::output



%% Edges
    rneDatabase --> projectsFilteredByEndDate
    dropdownResearcher --> projectsFilteredByEndDate
    dropdownCompany --> projectsFilteredByEndDate

    projectsFilteredByEndDate --> BQ2A1_projectsFilteredByEndDateAndCountSharedProjects --> table
    projectsFilteredByEndDate --> BQ2A2_projectsFilteredByEndDateAndCountSharedProjectsAndRankIt --> barchart
    projectsFilteredByEndDate --> BQ3A1_projectsFilteredByEndDateJoinWithResearchersAndCompanies --> table
    projectsFilteredByEndDate --> BQ3A2_projectsFilteredByEndDateCountProjectsPerCompanyAndRankIt --> barchart

    rneDatabase --> BQ4A1_projectsPerCompany --> table

    projectsFilteredByEndDate --> BQ5A1_projectsFilteredByEndDateAndGroupResearchersByDepartmentAndCountDepartmentPerCompanyAndRankIt --> table

    dropdownMainResearchGroup --> projectsFilteredByEndDate --> networkGraph

    rneDatabase --> BQ6A1_fteScorePerProject --> stackedBarchart
    rneDatabase --> BQ6A2_groupByRole --> barchart

%% Legend
    subgraph Legend
        L1[input]
        L2[(source)]
        L3>reactive]
        L4[[output]]
        class L1 input
        class L2 source
        class L3 reactive
        class L4 output
    end

%% Class Definitions
    classDef input fill:#E3F2FD,stroke:#90CAF9
    classDef source fill:#FFF3E0,stroke:#FFB74D
    classDef reactive fill:#E8F5E9,stroke:#81C784
    classDef output fill:#F3E5F5,stroke:#BA68C8