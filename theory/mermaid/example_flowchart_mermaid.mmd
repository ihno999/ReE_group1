flowchart TD
%% ===============================
%% K-means Clustering on Iris Data
%% ===============================

%% Inputs
%%  A[Select X variable]:::input
%%  B[Select Y variable]:::input
%%  C[Select number of clusters]:::input
    dropdownResearcher[dropdown for researcher]:::input
    dropdownCompany[dropdown for company]:::input
    dropdownMainResearchGroup[dropdown for main research group]:::input

%% Source
%%  D[(iris dataset)]:::source
    rneDatabase[(rne database)]:::source
    projectsFilteredByEndDate[("projects filtered by end date (researcher, department, company)")]:::source
    BQ4A1_projectsPerCompany[(projects per company, desc)]:::source
    BQ6A1_fteScorePerProject[(FTE score per project)]:::source
    BQ6A2_groupByRole[(group by role)]:::source

%% Reactives
%%  E>subset: iris, input$xvar, input$yvar]:::reactive
%%  F>kmeans, centers = input$clusters]:::reactive
    rneDatabase --> projectsFilteredByEndDate

    BQ2A1_projectsFilteredByEndDateAndCountSharedProjects>count shared projects per researcher]:::reactive
    BQ2A2_projectsFilteredByEndDateAndCountSharedProjectsAndRankIt>count shared projects per researcher, ranked]:::reactive

    BQ3A1_projectsFilteredByEndDateJoinWithResearchersAndCompanies>projects joined with researchers and companies]:::reactive
    BQ3A2_projectsFilteredByEndDateCountProjectsPerCompanyAndRankIt>count projects per comapny, ranked]:::reactive

    BQ5A1_projectsFilteredByEndDateAndGroupResearchersByDepartmentAndCountDepartmentPerCompanyAndRankIt>projects: group researchers by department count department per company and rank it]:::reactive
    BQ5A2_projectsFilteredByResearchersExpertise>projects by researchers expertise]:::reactive



%% Output
%%  G[[renderPlot: scatter plot with cluster colors]]:::output
    stackedBarchart[[stacked barchart]]:::output
    barchart[[barchart]]:::output
    table[[table]]:::output
    networkGraph[[network graph]]:::output



%% Edges
    rneDatabase --> projectsFilteredByEndDate

    dropdownResearcher --> BQ2A1_projectsFilteredByEndDateAndCountSharedProjects
    projectsFilteredByEndDate --> BQ2A1_projectsFilteredByEndDateAndCountSharedProjects --> table

    dropdownResearcher --> BQ2A2_projectsFilteredByEndDateAndCountSharedProjectsAndRankIt
    projectsFilteredByEndDate --> BQ2A2_projectsFilteredByEndDateAndCountSharedProjectsAndRankIt --> barchart

    dropdownResearcher --> BQ3A1_projectsFilteredByEndDateJoinWithResearchersAndCompanies
    projectsFilteredByEndDate --> BQ3A1_projectsFilteredByEndDateJoinWithResearchersAndCompanies --> table

    dropdownResearcher --> BQ3A2_projectsFilteredByEndDateCountProjectsPerCompanyAndRankIt
    projectsFilteredByEndDate --> BQ3A2_projectsFilteredByEndDateCountProjectsPerCompanyAndRankIt --> barchart

    rneDatabase --> BQ4A1_projectsPerCompany --> table

    dropdownCompany --> BQ5A1_projectsFilteredByEndDateAndGroupResearchersByDepartmentAndCountDepartmentPerCompanyAndRankIt
    projectsFilteredByEndDate --> BQ5A1_projectsFilteredByEndDateAndGroupResearchersByDepartmentAndCountDepartmentPerCompanyAndRankIt --> table

    dropdownMainResearchGroup --> BQ5A2_projectsFilteredByResearchersExpertise --> networkGraph

    rneDatabase --> BQ6A1_fteScorePerProject --> stackedBarchart
    rneDatabase --> BQ6A2_groupByRole --> barchart

%% Legend
    subgraph Legend
        L1[input]
        L2[(source)]
        L3>reactive]
        L4[[output]]
        class L1 input
        class L2 source
        class L3 reactive
        class L4 output
    end

%% Class Definitions
    classDef input fill:#E3F2FD,stroke:#90CAF9
    classDef source fill:#FFF3E0,stroke:#FFB74D
    classDef reactive fill:#E8F5E9,stroke:#81C784
    classDef output fill:#F3E5F5,stroke:#BA68C8